---
title: ä½¿ç”¨è‡ªç­¾SSLè¯ä¹¦ç»™å†…ç½‘é…ç½®HTTPS
author:
  name: è–„è·å±‹
  url: https://www.meowpass.com
category: 
  - æŠ€æœ¯æ•™ç¨‹
tag: 
  - SSL
  - Nginx
head:
  - [meta, { name: keywords , content: "linux,nginx,ssl,https,å†…ç½‘,å±€åŸŸç½‘,è‡ªç­¾è¯ä¹¦" }]
date: 2023-12-08 21:02:36
permalink: /pages/55e5fc/
excerpt: " "
---



## 1. ç”Ÿæˆè‡ªç­¾è¯ä¹¦

è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå¼€æºå·¥å…· [mkcert](https://github.com/FiloSottile/mkcert) æ¥å¿«é€Ÿç”Ÿæˆè¯ä¹¦ï¼Œå®‰è£…ç¯å¢ƒæ˜¯ `linux` æ“ä½œç³»ç»Ÿ

### 1.1 å®‰è£…mkcert

é¦–å…ˆå®‰è£… `libnss3-tools` ï¼š

```shell
sudo apt install libnss3-tools
```

ä½¿ç”¨é¢„å…ˆæ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼š

```shell
curl -JLO "https://dl.filippo.io/mkcert/latest?for=linux/amd64"
chmod +x mkcert-v*-linux-amd64
sudo cp mkcert-v*-linux-amd64 /usr/local/bin/mkcert
```

è¾“å…¥å‘½ä»¤ `mkcert -version` å¹¶ä¸”è¾“å‡ºç‰ˆæœ¬å·è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š

```shell
root@ubuntu:~# mkcert -version
v1.4.4
```

### 1.2 ç”Ÿæˆsslè¯ä¹¦

è¦åŒæ—¶ä¸ºå¤šä¸ªåŸŸåæˆ–è€… ip åœ°å€ç”Ÿæˆè¯ä¹¦ï¼Œå¯ä»¥ä½¿ç”¨ç©ºæ ¼åˆ†éš”å¼€è¿™äº›åœ°å€ï¼š

```shell
root@ubuntu:~/temp# mkcert 192.168.31.210 "*.a.com"
Created a new local CA ğŸ’¥
Note: the local CA is not installed in the system trust store.
Run "mkcert -install" for certificates to be trusted automatically âš ï¸

Created a new certificate valid for the following names ğŸ“œ
 - "192.168.31.210"
 - "*.a.com"

Reminder: X.509 wildcards only go one level deep, so this won't match a.b.a.com â„¹ï¸

The certificate is at "./192.168.31.210+1.pem" and the key at "./192.168.31.210+1-key.pem" âœ…

It will expire on 7 March 2026 ğŸ—“

```

æ‰§è¡Œå®Œå‘½ä»¤ä¹‹åï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œ`192.168.31.210+1.pem` å’Œ `192.168.31.210+1-key.pem` ï¼Œåˆ†åˆ«æ˜¯å…¬é’¥å’Œç§é’¥ã€‚

## 2. ä¸ºnginxé…ç½®https

æˆ‘ä»¬é€šè¿‡ nginx ä¸ºæœåŠ¡å™¨ä¸Šçš„æœ¬åœ°æœåŠ¡åšä»£ç†ï¼Œå¹¶ä¸ºè¯¥ä»£ç†é…ç½®httpsï¼Œå‡è®¾æˆ‘ä»¬æœ¬åœ°çš„æœåŠ¡åœ°å€æ˜¯ï¼š`http://127.0.0.1:9660` ï¼Œä¸ºè¿™ä¸ªåœ°å€ç®€å•å†™ä¸€ä¸ªnginxé…ç½®æ–‡ä»¶ï¼š

```nginx
server {
    listen 80; # ç›‘å¬80ç«¯å£
    listen 443 ssl; # ç›‘å¬443ç«¯å£ï¼Œå¹¶å¯ç”¨https

    ssl_certificate /cert/192.168.31.210+1.pem; # è¯ä¹¦æ–‡ä»¶è·¯å¾„
    ssl_certificate_key /cert/192.168.31.210+1-key.pem; # ç§é’¥æ–‡ä»¶è·¯å¾„

    # é…ç½®åŸŸå
    server_name 192.168.31.210;

    # é…ç½®httpsé‡å®šå‘
    if ($scheme = http) {
        return 301 https://$server_name$request_uri;
    }

    # é…ç½®ä»£ç†
    location / {
        proxy_pass http://127.0.0.1:9660;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

æ­¤æ—¶æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨è®¿é—®åˆšæ‰é…ç½®çš„åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨è¿˜æ˜¯æç¤ºä¸å®‰å…¨

![](/assets/page-img/2023/20231207/1.webp)

è¿™æ˜¯å› ä¸ºè¿™ä¸ª ssl è¯ä¹¦æ˜¯æˆ‘ä»¬è‡ªå·±ç­¾å‘çš„ï¼Œéœ€è¦åœ¨è‡ªå·±è®¿é—®è¯¥ç½‘ç«™ç”µè„‘ä¸Šå®‰è£…æ ¹è¯ä¹¦

## 3. å®‰è£…æ ¹è¯ä¹¦

ç”±äºæˆ‘æ˜¯åœ¨ linuxä¸Šç”Ÿæˆçš„è¯ä¹¦ï¼Œåœ¨ windows ä¸Šè®¿é—®çš„ç½‘ç«™ï¼Œæ‰€ä»¥æˆ‘è¿˜éœ€è¦åœ¨ windows ä¸Šå®‰è£…æ ¹è¯ä¹¦ã€‚

åœ¨ linux è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯æŸ¥çœ‹æ ¹è¯ä¹¦çš„ç›®å½•ï¼š

```shell
root@ubuntu:~# mkcert -CAROOT
/root/.local/share/mkcert
```

ç›®å½•ä¸­æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œ`rootCA-key.pem` å’Œ `rootCA.pem` ï¼Œå¤åˆ¶ `rootCA.pem` åˆ°ç”µè„‘ä¸Šï¼Œå¹¶å°† `rootCA.pem` é‡å‘½åä¸º `rootCA.crt` ï¼Œç„¶ååŒå‡»å®‰è£…ã€‚

![](/assets/page-img/2023/20231207/2.webp)

 å®‰è£…å®Œæˆä¹‹åï¼Œé‡å¯æµè§ˆå™¨ï¼Œå†æ¬¡æ‰“å¼€åˆšæ‰çš„åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°ä¸€åˆ‡å°±æ­£å¸¸äº†ã€‚

è‡³æ­¤ï¼Œä¸ºå†…ç½‘æœåŠ¡é…ç½®httpså°±å®Œæˆäº†ğŸ‰ğŸ‰

